# Email Triage Workflow - MobiCycle Productions Account ONLY
# DO NOT deploy to other accounts - contains business-specific logic

name = "workflow-email"
main = "src/index.ts"
compatibility_date = "2024-04-05"

# CRITICAL: Productions account ID only
account_id = "bdf4cedbc60ca9b2c1374c11996a67d7"

# Workflow Configuration
[[workflows]]
name = "email-triage"
binding = "EMAIL_TRIAGE"
class_name = "EmailTriageWorkflow"

# Productions-Specific Variables
[vars]
PROTON_EMAIL = "rose@mobicycle.productions"
TUNNEL_URL = "https://mail.mobicycle.productions"
BUSINESS_DOCS_URL = "https://documents.mobicycle.productions"
BUSINESS_DOCS_API_KEY = "business_docs_api_key_here"
NOTIFICATION_EMAIL = "suppliers@mobicycle.productions"
CLAUDE_WEBHOOK = "https://claude-webhook.mobicycle.productions"

# Business-Specific Settings
MAX_EMAILS_PER_BATCH = "20"  # Higher volume for business
APPROVAL_TIMEOUT_HOURS = "48"  # 2 days for business review
BUSINESS_RETENTION_YEARS = "5"  # Business document retention
SUPPLIER_PORTAL_ENABLED = "true"

# KV Namespaces for Business Management
[[kv_namespaces]]
binding = "BUSINESS_CASES"
id = "e0037f7006f94ff1bf1a35d43e914f11"

[[kv_namespaces]]
binding = "APPROVAL_QUEUE"
id = "7ffd95e04d354d38b77be792e3392999"

[[kv_namespaces]]
binding = "SUPPLIER_DATABASE"
id = "09f4a4ea2b584e819136f419e927c641"

[[kv_namespaces]]
binding = "BUSINESS_TEMPLATES"
id = "8e23cd9faed844aba9375271a4c853f6"

# R2 Buckets for Business Documents
[[r2_buckets]]
binding = "BUSINESS_DOCUMENTS"
bucket_name = "business-documents-productions"

[[r2_buckets]]
binding = "SUPPLIER_ATTACHMENTS"
bucket_name = "supplier-attachments-productions"

# AI Configuration for Business Analysis
[ai]
binding = "AI"

# Secrets (use: wrangler secret put SECRET_NAME)
# BUSINESS_DOCS_PRIVATE_KEY
# SUPPLIER_PORTAL_API_KEY
# BUSINESS_SYSTEM_CREDENTIALS
# CLAUDE_MCP_TOKEN_PRODUCTIONS

# Development Environment
[env.development]
name = "workflow-email-dev"
[env.development.vars]
TUNNEL_URL = "http://localhost:3001"  # Different port from mobicycle
BUSINESS_DOCS_URL = "https://dev.documents.mobicycle.productions"
APPROVAL_TIMEOUT_HOURS = "2"

# Production Environment
[env.production]
name = "workflow-email-prod"
[env.production.vars]
TUNNEL_URL = "https://mail.mobicycle.productions"
BUSINESS_DOCS_URL = "https://documents.mobicycle.productions"
APPROVAL_TIMEOUT_HOURS = "48"